{"version":3,"file":"environmentFactory.js","names":["_nodePath","require","_nodeProcess","_allureJsCommons","_interopRequireWildcard","allure","_sdk","_reporter","_runtime","_AllureJestTestRuntime","_utils","_excluded","e","t","WeakMap","r","n","__esModule","o","i","f","__proto__","default","has","get","set","_t","hasOwnProperty","call","Object","defineProperty","getOwnPropertyDescriptor","ownKeys","keys","getOwnPropertySymbols","filter","enumerable","push","apply","_objectSpread","arguments","length","forEach","_defineProperty","getOwnPropertyDescriptors","defineProperties","_objectWithoutProperties","_objectWithoutPropertiesLoose","indexOf","propertyIsEnumerable","_classPrivateMethodInitSpec","a","_checkPrivateRedeclaration","add","TypeError","_toPropertyKey","value","configurable","writable","_toPrimitive","Symbol","toPrimitive","String","Number","_assertClassBrand","createJestEnvironment","Base","_Class_brand","WeakSet","constructor","config","context","executables","steps","scopes","skippedTestsFullNamesByTestPlan","event","name","_handleHookStart","hook","_handleHookPass","_handleHookFail","error","_handleSuiteStart","_handleSuiteEnd","_handleTestScopeStart","_handleTestStart","test","_handleTestPass","_handleTestFail","_handleTestScopeStop","_handleTestSkip","_handleTestTodo","_handleRunFinish","projectConfig","_ref","testEnvironmentOptions","resultsDir","restConfig","runtime","ReporterRuntime","writer","createDefaultWriter","testPath","relative","rootDir","testPlan","parseTestPlan","testRuntime","AllureJestTestRuntime","global","setGlobalTestRuntime","setup","teardown","handleAllureRuntimeMessage","message","executableUuid","last","runContext","applyRuntimeMessages","_getTestFullName","testTitle","undefined","newTestSuitePath","getTestPath","parent","newTestPath","concat","newTestId","getTestId","getPosixPath","_startScope","_stopScope","shouldHookBeSkipped","scopeUuid","fixtureUuid","startFixture","type","pop","updateFixture","status","Status","PASSED","stage","Stage","FINISHED","stopFixture","BROKEN","getStatusFromError","statusDetails","trace","stack","_test$startedAt","fsPath","split","sep","titlePath","cleanTitle","labels","links","extractMetadataFromString","newTestFullName","isTestPresentInTestPlan","mode","testUuid","startTest","fullName","start","startedAt","RUNNING","getLanguageLabel","getFrameworkLabel","getPackageLabel","getHostLabel","getThreadLabel","env","JEST_WORKER_ID","getEnvironmentLabels","getSuiteLabels","_tr","_tr2","details","_statusAndDetails","errors","tr","updateTest","result","SKIPPED","writeTest","startScope","writeScope","_test$duration","_currentExecutable","suppressedErrors","expect","getState","statusAndDetails","stopTest","duration","_test$duration2","includes","writeEnvironmentInfo","writeCategoriesDefinitions","hasMultipleErrors","Array","isArray","exception","firstError","_convertToError","secondError","getMessageAndTraceFromError","serialize","exports"],"sources":["../../src/environmentFactory.ts"],"sourcesContent":["import type { EnvironmentContext, JestEnvironment, JestEnvironmentConfig } from \"@jest/environment\";\nimport type { Circus } from \"@jest/types\";\nimport { relative, sep } from \"node:path\";\nimport { env } from \"node:process\";\nimport * as allure from \"allure-js-commons\";\nimport { Stage, Status, type StatusDetails, type TestResult } from \"allure-js-commons\";\nimport { type RuntimeMessage, type TestPlanV1, serialize } from \"allure-js-commons/sdk\";\nimport { extractMetadataFromString, getMessageAndTraceFromError, getStatusFromError } from \"allure-js-commons/sdk\";\nimport {\n  ReporterRuntime,\n  createDefaultWriter,\n  getEnvironmentLabels,\n  getFrameworkLabel,\n  getHostLabel,\n  getLanguageLabel,\n  getPackageLabel,\n  getPosixPath,\n  getSuiteLabels,\n  getThreadLabel,\n  parseTestPlan,\n} from \"allure-js-commons/sdk/reporter\";\nimport { setGlobalTestRuntime } from \"allure-js-commons/sdk/runtime\";\nimport { AllureJestTestRuntime } from \"./AllureJestTestRuntime.js\";\nimport type { AllureJestConfig, AllureJestEnvironment, AllureJestProjectConfig, RunContext } from \"./model.js\";\nimport { getTestId, getTestPath, isTestPresentInTestPlan, last, shouldHookBeSkipped } from \"./utils.js\";\n\nconst createJestEnvironment = <T extends typeof JestEnvironment>(Base: T): T => {\n  // @ts-expect-error (ts(2545)) Incorrect assumption about a mixin class: https://github.com/microsoft/TypeScript/issues/37142\n  return class extends Base {\n    testPath: string;\n    testPlan?: TestPlanV1;\n    runtime: ReporterRuntime;\n    runContext: RunContext = {\n      executables: [],\n      steps: [],\n      scopes: [],\n      skippedTestsFullNamesByTestPlan: [],\n    };\n\n    // config is AllureJestConfig in Jest v28 or greater. In older versions\n    // it's AllureJestProjectConfig. See https://github.com/jestjs/jest/pull/12461\n    constructor(config: AllureJestConfig | AllureJestProjectConfig, context: EnvironmentContext) {\n      super(config as JestEnvironmentConfig, context);\n\n      const projectConfig = \"projectConfig\" in config ? config.projectConfig : config;\n      const { resultsDir, ...restConfig } = projectConfig?.testEnvironmentOptions || {};\n\n      this.runtime = new ReporterRuntime({\n        ...restConfig,\n        writer: createDefaultWriter({ resultsDir }),\n      });\n      this.testPath = relative(projectConfig.rootDir, context.testPath);\n      this.testPlan = parseTestPlan();\n\n      // @ts-ignore\n      const testRuntime = new AllureJestTestRuntime(this as AllureJestEnvironment, this.global);\n\n      // @ts-ignore\n      this.global.allure = allure;\n\n      setGlobalTestRuntime(testRuntime);\n    }\n\n    setup() {\n      return super.setup();\n    }\n\n    teardown() {\n      return super.teardown();\n    }\n\n    handleAllureRuntimeMessage(message: RuntimeMessage) {\n      const executableUuid = last(this.runContext.executables);\n\n      this.runtime.applyRuntimeMessages(executableUuid, [message]);\n    }\n\n    handleTestEvent = (event: Circus.Event) => {\n      switch (event.name) {\n        case \"hook_start\":\n          this.#handleHookStart(event.hook);\n          break;\n        case \"hook_success\":\n          this.#handleHookPass(event.hook);\n          break;\n        case \"hook_failure\":\n          this.#handleHookFail(event.hook, event.error);\n          break;\n        case \"run_describe_start\":\n          this.#handleSuiteStart();\n          break;\n        case \"run_describe_finish\":\n          this.#handleSuiteEnd();\n          break;\n        case \"test_start\":\n          this.#handleTestScopeStart();\n          break;\n        case \"test_fn_start\":\n          this.#handleTestStart(event.test);\n          break;\n        case \"test_fn_success\":\n          this.#handleTestPass(event.test);\n          break;\n        case \"test_fn_failure\":\n          this.#handleTestFail(event.test);\n          break;\n        case \"test_done\":\n          this.#handleTestScopeStop(event.test);\n          break;\n        case \"test_skip\":\n          this.#handleTestSkip(event.test);\n          break;\n        case \"test_todo\":\n          this.#handleTestTodo(event.test);\n          break;\n        case \"run_finish\":\n          this.#handleRunFinish();\n          break;\n        default:\n          break;\n      }\n    };\n\n    #getTestFullName(test: Circus.TestEntry, testTitle: string = test.name) {\n      const newTestSuitePath = getTestPath(test.parent);\n      const newTestPath = newTestSuitePath.concat(testTitle);\n      const newTestId = getTestId(newTestPath);\n\n      return `${getPosixPath(this.testPath)}#${newTestId}`;\n    }\n\n    #handleSuiteStart() {\n      this.#startScope();\n    }\n\n    #handleSuiteEnd() {\n      this.#stopScope();\n    }\n\n    #handleHookStart(hook: Circus.Hook) {\n      if (shouldHookBeSkipped(hook)) {\n        return;\n      }\n\n      const scopeUuid = last(this.runContext.scopes);\n      const fixtureUuid = this.runtime.startFixture(scopeUuid, /after/i.test(hook.type) ? \"after\" : \"before\", {\n        name: hook.type,\n      })!;\n\n      this.runContext.executables.push(fixtureUuid);\n    }\n\n    #handleHookPass(hook: Circus.Hook) {\n      if (shouldHookBeSkipped(hook)) {\n        return;\n      }\n\n      const fixtureUuid = this.runContext.executables.pop()!;\n\n      this.runtime.updateFixture(fixtureUuid, (r) => {\n        r.status = Status.PASSED;\n        r.stage = Stage.FINISHED;\n      });\n      this.runtime.stopFixture(fixtureUuid);\n    }\n\n    #handleHookFail(hook: Circus.Hook, error: string | Circus.Exception) {\n      if (shouldHookBeSkipped(hook)) {\n        return;\n      }\n\n      const fixtureUuid = this.runContext.executables.pop()!;\n      const status = typeof error === \"string\" ? Status.BROKEN : getStatusFromError(error as Error);\n\n      this.runtime.updateFixture(fixtureUuid, (r) => {\n        r.status = status;\n        r.statusDetails = {\n          message: typeof error === \"string\" ? error : error.message,\n          trace: typeof error === \"string\" ? undefined : error.stack,\n        };\n        r.stage = Stage.FINISHED;\n      });\n      this.runtime.stopFixture(fixtureUuid);\n    }\n\n    #handleTestStart(test: Circus.TestEntry) {\n      const fsPath = this.testPath.split(sep);\n      const newTestSuitePath = getTestPath(test.parent);\n      const titlePath = fsPath.concat(newTestSuitePath);\n      const { cleanTitle, labels, links } = extractMetadataFromString(test.name);\n      const newTestFullName = this.#getTestFullName(test, cleanTitle);\n\n      if (this.testPlan && !isTestPresentInTestPlan(newTestFullName, this.testPlan)) {\n        test.mode = \"skip\";\n        this.runContext.skippedTestsFullNamesByTestPlan.push(newTestFullName);\n        return;\n      }\n\n      const testUuid = this.runtime.startTest(\n        {\n          name: cleanTitle,\n          fullName: newTestFullName,\n          start: test.startedAt ?? undefined,\n          stage: Stage.RUNNING,\n          labels: [\n            getLanguageLabel(),\n            getFrameworkLabel(\"jest\"),\n            getPackageLabel(this.testPath),\n            getHostLabel(),\n            getThreadLabel(env.JEST_WORKER_ID),\n            ...getEnvironmentLabels(),\n            ...getSuiteLabels(newTestSuitePath),\n            ...labels,\n          ],\n          titlePath,\n          links,\n        },\n        this.runContext.scopes,\n      );\n\n      this.runContext.executables.push(testUuid);\n\n      return testUuid;\n    }\n\n    #handleTestScopeStart() {\n      this.#startScope();\n    }\n\n    #handleTestScopeStop(test: Circus.TestEntry) {\n      const testUuid = this.runContext.executables.pop();\n\n      if (testUuid) {\n        const { details } = this.#statusAndDetails(test.errors);\n        let tr: TestResult | undefined;\n        this.runtime.updateTest(testUuid, (result) => {\n          tr = result;\n        });\n        // hook failure, finish as skipped\n        if (tr?.status === undefined && tr?.stage === Stage.RUNNING) {\n          this.runtime.updateTest(testUuid, (result) => {\n            result.stage = Stage.FINISHED;\n            result.status = Status.SKIPPED;\n            result.statusDetails = {\n              ...result.statusDetails,\n              ...details,\n            };\n          });\n        }\n\n        this.runtime.writeTest(testUuid);\n      }\n\n      this.#stopScope();\n    }\n\n    #startScope() {\n      const scopeUuid = this.runtime.startScope();\n\n      this.runContext.scopes.push(scopeUuid);\n    }\n\n    #stopScope() {\n      const scopeUuid = this.runContext.scopes.pop();\n      if (!scopeUuid) {\n        return;\n      }\n\n      this.runtime.writeScope(scopeUuid);\n    }\n\n    #handleTestPass(test: Circus.TestEntry) {\n      const testUuid = this.#currentExecutable();\n\n      if (!testUuid) {\n        return;\n      }\n      // @ts-ignore\n      const { suppressedErrors = [] } = this.global.expect.getState();\n      const statusAndDetails = this.#statusAndDetails(suppressedErrors as Circus.TestError[]);\n\n      this.runtime.updateTest(testUuid, (result) => {\n        result.stage = Stage.FINISHED;\n        result.status = statusAndDetails.status;\n        result.statusDetails = {\n          ...result.statusDetails,\n          ...statusAndDetails.details,\n        };\n      });\n\n      this.runtime.stopTest(testUuid, { duration: test.duration ?? 0 });\n    }\n\n    #handleTestFail(test: Circus.TestEntry) {\n      const testUuid = this.#currentExecutable();\n\n      if (!testUuid) {\n        return;\n      }\n\n      const { status, details } = this.#statusAndDetails(test.errors);\n\n      this.runtime.updateTest(testUuid, (result) => {\n        result.stage = Stage.FINISHED;\n        result.status = status;\n        result.statusDetails = {\n          ...result.statusDetails,\n          ...details,\n        };\n      });\n      this.runtime.stopTest(testUuid, { duration: test.duration ?? 0 });\n    }\n\n    #handleTestSkip(test: Circus.TestEntry) {\n      const newTestFullName = this.#getTestFullName(test);\n\n      if (this.runContext.skippedTestsFullNamesByTestPlan.includes(newTestFullName)) {\n        return;\n      }\n\n      // noinspection JSPotentiallyInvalidUsageOfThis\n      const testUuid = this.#handleTestStart(test);\n\n      if (!testUuid) {\n        return;\n      }\n\n      this.runtime.updateTest(testUuid, (result) => {\n        result.stage = Stage.FINISHED;\n        result.status = Status.SKIPPED;\n      });\n      // noinspection JSPotentiallyInvalidUsageOfThis\n      this.#handleTestScopeStop(test);\n    }\n\n    #handleTestTodo(test: Circus.TestEntry) {\n      // noinspection JSPotentiallyInvalidUsageOfThis\n      const testUuid = this.#handleTestStart(test);\n      if (!testUuid) {\n        return;\n      }\n\n      this.runtime.updateTest(testUuid, (result) => {\n        result.stage = Stage.FINISHED;\n        result.status = Status.SKIPPED;\n        result.statusDetails = {\n          message: \"TODO\",\n        };\n      });\n      // noinspection JSPotentiallyInvalidUsageOfThis\n      this.#handleTestScopeStop(test);\n    }\n\n    #handleRunFinish() {\n      this.runtime.writeEnvironmentInfo();\n      this.runtime.writeCategoriesDefinitions();\n    }\n\n    #currentExecutable() {\n      if (this.runContext.executables.length === 0) {\n        return undefined;\n      }\n      return this.runContext.executables[this.runContext.executables.length - 1];\n    }\n\n    #statusAndDetails(errors: Circus.TestError[]): { status: Status; details: Partial<StatusDetails> } {\n      if (errors.length === 0) {\n        return {\n          status: Status.PASSED,\n          details: {},\n        };\n      }\n\n      // jest collects all errors, but we need to report the first one because it's a reason why the test has been failed\n      const [error] = errors;\n      const hasMultipleErrors = Array.isArray(error);\n      const exception: Circus.Exception = hasMultipleErrors ? error[0] : error;\n      const firstError = this.#convertToError(exception);\n\n      // in case user throws non-Error type, the first exception is the user-thrown object,\n      // while the second one is provided by jest and has correct stack trace\n      if (hasMultipleErrors && error.length > 1) {\n        const secondError = this.#convertToError(error[1]);\n\n        if (!firstError.message) {\n          firstError.message = secondError.message;\n        }\n\n        if (!firstError.stack) {\n          firstError.stack = secondError.stack;\n        }\n      }\n\n      const details = getMessageAndTraceFromError(firstError);\n      const status = getStatusFromError(firstError);\n\n      return { status, details };\n    }\n\n    #convertToError(exception: Circus.Exception):\n      | Error\n      | {\n          message?: string;\n          stack?: string;\n        } {\n      if (!exception) {\n        return {};\n      }\n\n      // user may throw an object as well\n      if (typeof exception !== \"object\" || !(\"stack\" in exception)) {\n        return {\n          message: serialize(exception),\n        };\n      }\n\n      return exception;\n    }\n  };\n};\n\nexport { createJestEnvironment };\n"],"mappings":";;;;;;AAEA,IAAAA,SAAA,GAAAC,OAAA;AACA,IAAAC,YAAA,GAAAD,OAAA;AACA,IAAAE,gBAAA,GAAAC,uBAAA,CAAAH,OAAA;AAA4C,IAAAI,MAAA,GAAAF,gBAAA;AAE5C,IAAAG,IAAA,GAAAL,OAAA;AAEA,IAAAM,SAAA,GAAAN,OAAA;AAaA,IAAAO,QAAA,GAAAP,OAAA;AACA,IAAAQ,sBAAA,GAAAR,OAAA;AAEA,IAAAS,MAAA,GAAAT,OAAA;AAAwG,IAAAU,SAAA;AAAA,SAAAP,wBAAAQ,CAAA,EAAAC,CAAA,6BAAAC,OAAA,MAAAC,CAAA,OAAAD,OAAA,IAAAE,CAAA,OAAAF,OAAA,YAAAV,uBAAA,YAAAA,wBAAAQ,CAAA,EAAAC,CAAA,SAAAA,CAAA,IAAAD,CAAA,IAAAA,CAAA,CAAAK,UAAA,SAAAL,CAAA,MAAAM,CAAA,EAAAC,CAAA,EAAAC,CAAA,KAAAC,SAAA,QAAAC,OAAA,EAAAV,CAAA,iBAAAA,CAAA,uBAAAA,CAAA,yBAAAA,CAAA,SAAAQ,CAAA,MAAAF,CAAA,GAAAL,CAAA,GAAAG,CAAA,GAAAD,CAAA,QAAAG,CAAA,CAAAK,GAAA,CAAAX,CAAA,UAAAM,CAAA,CAAAM,GAAA,CAAAZ,CAAA,GAAAM,CAAA,CAAAO,GAAA,CAAAb,CAAA,EAAAQ,CAAA,cAAAM,EAAA,IAAAd,CAAA,gBAAAc,EAAA,OAAAC,cAAA,CAAAC,IAAA,CAAAhB,CAAA,EAAAc,EAAA,OAAAP,CAAA,IAAAD,CAAA,GAAAW,MAAA,CAAAC,cAAA,KAAAD,MAAA,CAAAE,wBAAA,CAAAnB,CAAA,EAAAc,EAAA,OAAAP,CAAA,CAAAK,GAAA,IAAAL,CAAA,CAAAM,GAAA,IAAAP,CAAA,CAAAE,CAAA,EAAAM,EAAA,EAAAP,CAAA,IAAAC,CAAA,CAAAM,EAAA,IAAAd,CAAA,CAAAc,EAAA,WAAAN,CAAA,KAAAR,CAAA,EAAAC,CAAA;AAAA,SAAAmB,QAAApB,CAAA,EAAAG,CAAA,QAAAF,CAAA,GAAAgB,MAAA,CAAAI,IAAA,CAAArB,CAAA,OAAAiB,MAAA,CAAAK,qBAAA,QAAAhB,CAAA,GAAAW,MAAA,CAAAK,qBAAA,CAAAtB,CAAA,GAAAG,CAAA,KAAAG,CAAA,GAAAA,CAAA,CAAAiB,MAAA,WAAApB,CAAA,WAAAc,MAAA,CAAAE,wBAAA,CAAAnB,CAAA,EAAAG,CAAA,EAAAqB,UAAA,OAAAvB,CAAA,CAAAwB,IAAA,CAAAC,KAAA,CAAAzB,CAAA,EAAAK,CAAA,YAAAL,CAAA;AAAA,SAAA0B,cAAA3B,CAAA,aAAAG,CAAA,MAAAA,CAAA,GAAAyB,SAAA,CAAAC,MAAA,EAAA1B,CAAA,UAAAF,CAAA,WAAA2B,SAAA,CAAAzB,CAAA,IAAAyB,SAAA,CAAAzB,CAAA,QAAAA,CAAA,OAAAiB,OAAA,CAAAH,MAAA,CAAAhB,CAAA,OAAA6B,OAAA,WAAA3B,CAAA,IAAA4B,eAAA,CAAA/B,CAAA,EAAAG,CAAA,EAAAF,CAAA,CAAAE,CAAA,SAAAc,MAAA,CAAAe,yBAAA,GAAAf,MAAA,CAAAgB,gBAAA,CAAAjC,CAAA,EAAAiB,MAAA,CAAAe,yBAAA,CAAA/B,CAAA,KAAAmB,OAAA,CAAAH,MAAA,CAAAhB,CAAA,GAAA6B,OAAA,WAAA3B,CAAA,IAAAc,MAAA,CAAAC,cAAA,CAAAlB,CAAA,EAAAG,CAAA,EAAAc,MAAA,CAAAE,wBAAA,CAAAlB,CAAA,EAAAE,CAAA,iBAAAH,CAAA;AAAA,SAAAkC,yBAAAlC,CAAA,EAAAC,CAAA,gBAAAD,CAAA,iBAAAM,CAAA,EAAAH,CAAA,EAAAI,CAAA,GAAA4B,6BAAA,CAAAnC,CAAA,EAAAC,CAAA,OAAAgB,MAAA,CAAAK,qBAAA,QAAAlB,CAAA,GAAAa,MAAA,CAAAK,qBAAA,CAAAtB,CAAA,QAAAG,CAAA,MAAAA,CAAA,GAAAC,CAAA,CAAAyB,MAAA,EAAA1B,CAAA,IAAAG,CAAA,GAAAF,CAAA,CAAAD,CAAA,UAAAF,CAAA,CAAAmC,OAAA,CAAA9B,CAAA,QAAA+B,oBAAA,CAAArB,IAAA,CAAAhB,CAAA,EAAAM,CAAA,MAAAC,CAAA,CAAAD,CAAA,IAAAN,CAAA,CAAAM,CAAA,aAAAC,CAAA;AAAA,SAAA4B,8BAAAhC,CAAA,EAAAH,CAAA,gBAAAG,CAAA,iBAAAF,CAAA,gBAAAG,CAAA,IAAAD,CAAA,SAAAY,cAAA,CAAAC,IAAA,CAAAb,CAAA,EAAAC,CAAA,gBAAAJ,CAAA,CAAAoC,OAAA,CAAAhC,CAAA,aAAAH,CAAA,CAAAG,CAAA,IAAAD,CAAA,CAAAC,CAAA,YAAAH,CAAA;AAAA,SAAAqC,4BAAAtC,CAAA,EAAAuC,CAAA,IAAAC,0BAAA,CAAAxC,CAAA,EAAAuC,CAAA,GAAAA,CAAA,CAAAE,GAAA,CAAAzC,CAAA;AAAA,SAAAwC,2BAAAxC,CAAA,EAAAC,CAAA,QAAAA,CAAA,CAAAU,GAAA,CAAAX,CAAA,aAAA0C,SAAA;AAAA,SAAAX,gBAAA/B,CAAA,EAAAG,CAAA,EAAAF,CAAA,YAAAE,CAAA,GAAAwC,cAAA,CAAAxC,CAAA,MAAAH,CAAA,GAAAiB,MAAA,CAAAC,cAAA,CAAAlB,CAAA,EAAAG,CAAA,IAAAyC,KAAA,EAAA3C,CAAA,EAAAuB,UAAA,MAAAqB,YAAA,MAAAC,QAAA,UAAA9C,CAAA,CAAAG,CAAA,IAAAF,CAAA,EAAAD,CAAA;AAAA,SAAA2C,eAAA1C,CAAA,QAAAM,CAAA,GAAAwC,YAAA,CAAA9C,CAAA,uCAAAM,CAAA,GAAAA,CAAA,GAAAA,CAAA;AAAA,SAAAwC,aAAA9C,CAAA,EAAAE,CAAA,2BAAAF,CAAA,KAAAA,CAAA,SAAAA,CAAA,MAAAD,CAAA,GAAAC,CAAA,CAAA+C,MAAA,CAAAC,WAAA,kBAAAjD,CAAA,QAAAO,CAAA,GAAAP,CAAA,CAAAgB,IAAA,CAAAf,CAAA,EAAAE,CAAA,uCAAAI,CAAA,SAAAA,CAAA,YAAAmC,SAAA,yEAAAvC,CAAA,GAAA+C,MAAA,GAAAC,MAAA,EAAAlD,CAAA;AAAA,SAAAmD,kBAAApD,CAAA,EAAAC,CAAA,EAAAG,CAAA,6BAAAJ,CAAA,GAAAA,CAAA,KAAAC,CAAA,GAAAD,CAAA,CAAAW,GAAA,CAAAV,CAAA,UAAA2B,SAAA,CAAAC,MAAA,OAAA5B,CAAA,GAAAG,CAAA,YAAAsC,SAAA;AAExG,IAAMW,qBAAqB,GAAsCC,IAAO,IAAQ;EAAA,IAAAC,YAAA;EAC9E;EACA,OAAAA,YAAA,oBAAAC,OAAA,IAAO,cAAcF,IAAI,CAAC;IAWxB;IACA;IACAG,WAAWA,CAACC,MAAkD,EAAEC,OAA2B,EAAE;MAC3F,KAAK,CAACD,MAAM,EAA2BC,OAAO,CAAC;MAACrB,2BAAA,OAAAiB,YAAA;MAAAxB,eAAA;MAAAA,eAAA;MAAAA,eAAA;MAAAA,eAAA,qBAVzB;QACvB6B,WAAW,EAAE,EAAE;QACfC,KAAK,EAAE,EAAE;QACTC,MAAM,EAAE,EAAE;QACVC,+BAA+B,EAAE;MACnC,CAAC;MAAAhC,eAAA,0BAwCkBiC,KAAmB,IAAK;QACzC,QAAQA,KAAK,CAACC,IAAI;UAChB,KAAK,YAAY;YACfb,iBAAA,CAAAG,YAAA,MAAI,EAACW,gBAAe,CAAC,CAAAlD,IAAA,CAArB,IAAI,EAAkBgD,KAAK,CAACG,IAAI;YAChC;UACF,KAAK,cAAc;YACjBf,iBAAA,CAAAG,YAAA,MAAI,EAACa,eAAc,CAAC,CAAApD,IAAA,CAApB,IAAI,EAAiBgD,KAAK,CAACG,IAAI;YAC/B;UACF,KAAK,cAAc;YACjBf,iBAAA,CAAAG,YAAA,MAAI,EAACc,eAAc,CAAC,CAAArD,IAAA,CAApB,IAAI,EAAiBgD,KAAK,CAACG,IAAI,EAAEH,KAAK,CAACM,KAAK;YAC5C;UACF,KAAK,oBAAoB;YACvBlB,iBAAA,CAAAG,YAAA,MAAI,EAACgB,iBAAgB,CAAC,CAAAvD,IAAA,CAAtB,IAAI;YACJ;UACF,KAAK,qBAAqB;YACxBoC,iBAAA,CAAAG,YAAA,MAAI,EAACiB,eAAc,CAAC,CAAAxD,IAAA,CAApB,IAAI;YACJ;UACF,KAAK,YAAY;YACfoC,iBAAA,CAAAG,YAAA,MAAI,EAACkB,qBAAoB,CAAC,CAAAzD,IAAA,CAA1B,IAAI;YACJ;UACF,KAAK,eAAe;YAClBoC,iBAAA,CAAAG,YAAA,MAAI,EAACmB,gBAAe,CAAC,CAAA1D,IAAA,CAArB,IAAI,EAAkBgD,KAAK,CAACW,IAAI;YAChC;UACF,KAAK,iBAAiB;YACpBvB,iBAAA,CAAAG,YAAA,MAAI,EAACqB,eAAc,CAAC,CAAA5D,IAAA,CAApB,IAAI,EAAiBgD,KAAK,CAACW,IAAI;YAC/B;UACF,KAAK,iBAAiB;YACpBvB,iBAAA,CAAAG,YAAA,MAAI,EAACsB,eAAc,CAAC,CAAA7D,IAAA,CAApB,IAAI,EAAiBgD,KAAK,CAACW,IAAI;YAC/B;UACF,KAAK,WAAW;YACdvB,iBAAA,CAAAG,YAAA,MAAI,EAACuB,oBAAmB,CAAC,CAAA9D,IAAA,CAAzB,IAAI,EAAsBgD,KAAK,CAACW,IAAI;YACpC;UACF,KAAK,WAAW;YACdvB,iBAAA,CAAAG,YAAA,MAAI,EAACwB,eAAc,CAAC,CAAA/D,IAAA,CAApB,IAAI,EAAiBgD,KAAK,CAACW,IAAI;YAC/B;UACF,KAAK,WAAW;YACdvB,iBAAA,CAAAG,YAAA,MAAI,EAACyB,eAAc,CAAC,CAAAhE,IAAA,CAApB,IAAI,EAAiBgD,KAAK,CAACW,IAAI;YAC/B;UACF,KAAK,YAAY;YACfvB,iBAAA,CAAAG,YAAA,MAAI,EAAC0B,gBAAe,CAAC,CAAAjE,IAAA,CAArB,IAAI;YACJ;UACF;YACE;QACJ;MACF,CAAC;MA7EC,IAAMkE,aAAa,GAAG,eAAe,IAAIxB,MAAM,GAAGA,MAAM,CAACwB,aAAa,GAAGxB,MAAM;MAC/E,IAAAyB,IAAA,GAAsC,CAAAD,aAAa,aAAbA,aAAa,uBAAbA,aAAa,CAAEE,sBAAsB,KAAI,CAAC,CAAC;QAA3E;UAAEC;QAA0B,CAAC,GAAAF,IAAA;QAAZG,UAAU,GAAApD,wBAAA,CAAAiD,IAAA,EAAApF,SAAA;MAEjC,IAAI,CAACwF,OAAO,GAAG,IAAIC,yBAAe,CAAA7D,aAAA,CAAAA,aAAA,KAC7B2D,UAAU;QACbG,MAAM,EAAE,IAAAC,6BAAmB,EAAC;UAAEL;QAAW,CAAC;MAAC,EAC5C,CAAC;MACF,IAAI,CAACM,QAAQ,GAAG,IAAAC,kBAAQ,EAACV,aAAa,CAACW,OAAO,EAAElC,OAAO,CAACgC,QAAQ,CAAC;MACjE,IAAI,CAACG,QAAQ,GAAG,IAAAC,uBAAa,EAAC,CAAC;;MAE/B;MACA,IAAMC,WAAW,GAAG,IAAIC,4CAAqB,CAAC,IAAI,EAA2B,IAAI,CAACC,MAAM,CAAC;;MAEzF;MACA,IAAI,CAACA,MAAM,CAACzG,MAAM,GAAGA,MAAM;MAE3B,IAAA0G,6BAAoB,EAACH,WAAW,CAAC;IACnC;IAEAI,KAAKA,CAAA,EAAG;MACN,OAAO,KAAK,CAACA,KAAK,CAAC,CAAC;IACtB;IAEAC,QAAQA,CAAA,EAAG;MACT,OAAO,KAAK,CAACA,QAAQ,CAAC,CAAC;IACzB;IAEAC,0BAA0BA,CAACC,OAAuB,EAAE;MAClD,IAAMC,cAAc,GAAG,IAAAC,WAAI,EAAC,IAAI,CAACC,UAAU,CAAC9C,WAAW,CAAC;MAExD,IAAI,CAAC2B,OAAO,CAACoB,oBAAoB,CAACH,cAAc,EAAE,CAACD,OAAO,CAAC,CAAC;IAC9D;EAuVF,CAAC;EAAC,SAAAK,iBAvSiBjC,IAAsB,EAAiC;IAAA,IAA/BkC,SAAiB,GAAAjF,SAAA,CAAAC,MAAA,QAAAD,SAAA,QAAAkF,SAAA,GAAAlF,SAAA,MAAG+C,IAAI,CAACV,IAAI;IACpE,IAAM8C,gBAAgB,GAAG,IAAAC,kBAAW,EAACrC,IAAI,CAACsC,MAAM,CAAC;IACjD,IAAMC,WAAW,GAAGH,gBAAgB,CAACI,MAAM,CAACN,SAAS,CAAC;IACtD,IAAMO,SAAS,GAAG,IAAAC,gBAAS,EAACH,WAAW,CAAC;IAExC,UAAAC,MAAA,CAAU,IAAAG,sBAAY,EAAC,IAAI,CAAC3B,QAAQ,CAAC,OAAAwB,MAAA,CAAIC,SAAS;EACpD;EAAC,SAAA7C,kBAAA,EAEmB;IAClBnB,iBAAA,CAAAG,YAAA,MAAI,EAACgE,WAAU,CAAC,CAAAvG,IAAA,CAAhB,IAAI;EACN;EAAC,SAAAwD,gBAAA,EAEiB;IAChBpB,iBAAA,CAAAG,YAAA,MAAI,EAACiE,UAAS,CAAC,CAAAxG,IAAA,CAAf,IAAI;EACN;EAAC,SAAAkD,iBAEgBC,IAAiB,EAAE;IAClC,IAAI,IAAAsD,0BAAmB,EAACtD,IAAI,CAAC,EAAE;MAC7B;IACF;IAEA,IAAMuD,SAAS,GAAG,IAAAjB,WAAI,EAAC,IAAI,CAACC,UAAU,CAAC5C,MAAM,CAAC;IAC9C,IAAM6D,WAAW,GAAG,IAAI,CAACpC,OAAO,CAACqC,YAAY,CAACF,SAAS,EAAE,QAAQ,CAAC/C,IAAI,CAACR,IAAI,CAAC0D,IAAI,CAAC,GAAG,OAAO,GAAG,QAAQ,EAAE;MACtG5D,IAAI,EAAEE,IAAI,CAAC0D;IACb,CAAC,CAAE;IAEH,IAAI,CAACnB,UAAU,CAAC9C,WAAW,CAACnC,IAAI,CAACkG,WAAW,CAAC;EAC/C;EAAC,SAAAvD,gBAEeD,IAAiB,EAAE;IACjC,IAAI,IAAAsD,0BAAmB,EAACtD,IAAI,CAAC,EAAE;MAC7B;IACF;IAEA,IAAMwD,WAAW,GAAG,IAAI,CAACjB,UAAU,CAAC9C,WAAW,CAACkE,GAAG,CAAC,CAAE;IAEtD,IAAI,CAACvC,OAAO,CAACwC,aAAa,CAACJ,WAAW,EAAGxH,CAAC,IAAK;MAC7CA,CAAC,CAAC6H,MAAM,GAAGC,uBAAM,CAACC,MAAM;MACxB/H,CAAC,CAACgI,KAAK,GAAGC,sBAAK,CAACC,QAAQ;IAC1B,CAAC,CAAC;IACF,IAAI,CAAC9C,OAAO,CAAC+C,WAAW,CAACX,WAAW,CAAC;EACvC;EAAC,SAAAtD,gBAEeF,IAAiB,EAAEG,KAAgC,EAAE;IACnE,IAAI,IAAAmD,0BAAmB,EAACtD,IAAI,CAAC,EAAE;MAC7B;IACF;IAEA,IAAMwD,WAAW,GAAG,IAAI,CAACjB,UAAU,CAAC9C,WAAW,CAACkE,GAAG,CAAC,CAAE;IACtD,IAAME,MAAM,GAAG,OAAO1D,KAAK,KAAK,QAAQ,GAAG2D,uBAAM,CAACM,MAAM,GAAG,IAAAC,uBAAkB,EAAClE,KAAc,CAAC;IAE7F,IAAI,CAACiB,OAAO,CAACwC,aAAa,CAACJ,WAAW,EAAGxH,CAAC,IAAK;MAC7CA,CAAC,CAAC6H,MAAM,GAAGA,MAAM;MACjB7H,CAAC,CAACsI,aAAa,GAAG;QAChBlC,OAAO,EAAE,OAAOjC,KAAK,KAAK,QAAQ,GAAGA,KAAK,GAAGA,KAAK,CAACiC,OAAO;QAC1DmC,KAAK,EAAE,OAAOpE,KAAK,KAAK,QAAQ,GAAGwC,SAAS,GAAGxC,KAAK,CAACqE;MACvD,CAAC;MACDxI,CAAC,CAACgI,KAAK,GAAGC,sBAAK,CAACC,QAAQ;IAC1B,CAAC,CAAC;IACF,IAAI,CAAC9C,OAAO,CAAC+C,WAAW,CAACX,WAAW,CAAC;EACvC;EAAC,SAAAjD,iBAEgBC,IAAsB,EAAE;IAAA,IAAAiE,eAAA;IACvC,IAAMC,MAAM,GAAG,IAAI,CAAClD,QAAQ,CAACmD,KAAK,CAACC,aAAG,CAAC;IACvC,IAAMhC,gBAAgB,GAAG,IAAAC,kBAAW,EAACrC,IAAI,CAACsC,MAAM,CAAC;IACjD,IAAM+B,SAAS,GAAGH,MAAM,CAAC1B,MAAM,CAACJ,gBAAgB,CAAC;IACjD,IAAM;MAAEkC,UAAU;MAAEC,MAAM;MAAEC;IAAM,CAAC,GAAG,IAAAC,8BAAyB,EAACzE,IAAI,CAACV,IAAI,CAAC;IAC1E,IAAMoF,eAAe,GAAGjG,iBAAA,CAAAG,YAAA,MAAI,EAACqD,gBAAe,CAAC,CAAA5F,IAAA,CAArB,IAAI,EAAkB2D,IAAI,EAAEsE,UAAU,CAAC;IAE/D,IAAI,IAAI,CAACnD,QAAQ,IAAI,CAAC,IAAAwD,8BAAuB,EAACD,eAAe,EAAE,IAAI,CAACvD,QAAQ,CAAC,EAAE;MAC7EnB,IAAI,CAAC4E,IAAI,GAAG,MAAM;MAClB,IAAI,CAAC7C,UAAU,CAAC3C,+BAA+B,CAACtC,IAAI,CAAC4H,eAAe,CAAC;MACrE;IACF;IAEA,IAAMG,QAAQ,GAAG,IAAI,CAACjE,OAAO,CAACkE,SAAS,CACrC;MACExF,IAAI,EAAEgF,UAAU;MAChBS,QAAQ,EAAEL,eAAe;MACzBM,KAAK,GAAAf,eAAA,GAAEjE,IAAI,CAACiF,SAAS,cAAAhB,eAAA,cAAAA,eAAA,GAAI9B,SAAS;MAClCqB,KAAK,EAAEC,sBAAK,CAACyB,OAAO;MACpBX,MAAM,EAAE,CACN,IAAAY,0BAAgB,EAAC,CAAC,EAClB,IAAAC,2BAAiB,EAAC,MAAM,CAAC,EACzB,IAAAC,yBAAe,EAAC,IAAI,CAACrE,QAAQ,CAAC,EAC9B,IAAAsE,sBAAY,EAAC,CAAC,EACd,IAAAC,wBAAc,EAACC,gBAAG,CAACC,cAAc,CAAC,EAClC,GAAG,IAAAC,8BAAoB,EAAC,CAAC,EACzB,GAAG,IAAAC,wBAAc,EAACvD,gBAAgB,CAAC,EACnC,GAAGmC,MAAM,CACV;MACDF,SAAS;MACTG;IACF,CAAC,EACD,IAAI,CAACzC,UAAU,CAAC5C,MAClB,CAAC;IAED,IAAI,CAAC4C,UAAU,CAAC9C,WAAW,CAACnC,IAAI,CAAC+H,QAAQ,CAAC;IAE1C,OAAOA,QAAQ;EACjB;EAAC,SAAA/E,sBAAA,EAEuB;IACtBrB,iBAAA,CAAAG,YAAA,MAAI,EAACgE,WAAU,CAAC,CAAAvG,IAAA,CAAhB,IAAI;EACN;EAAC,SAAA8D,qBAEoBH,IAAsB,EAAE;IAC3C,IAAM6E,QAAQ,GAAG,IAAI,CAAC9C,UAAU,CAAC9C,WAAW,CAACkE,GAAG,CAAC,CAAC;IAElD,IAAI0B,QAAQ,EAAE;MAAA,IAAAe,GAAA,EAAAC,IAAA;MACZ,IAAM;QAAEC;MAAQ,CAAC,GAAGrH,iBAAA,CAAAG,YAAA,MAAI,EAACmH,iBAAgB,CAAC,CAAA1J,IAAA,CAAtB,IAAI,EAAmB2D,IAAI,CAACgG,MAAM,CAAC;MACvD,IAAIC,EAA0B;MAC9B,IAAI,CAACrF,OAAO,CAACsF,UAAU,CAACrB,QAAQ,EAAGsB,MAAM,IAAK;QAC5CF,EAAE,GAAGE,MAAM;MACb,CAAC,CAAC;MACF;MACA,IAAI,EAAAP,GAAA,GAAAK,EAAE,cAAAL,GAAA,uBAAFA,GAAA,CAAIvC,MAAM,MAAKlB,SAAS,IAAI,EAAA0D,IAAA,GAAAI,EAAE,cAAAJ,IAAA,uBAAFA,IAAA,CAAIrC,KAAK,MAAKC,sBAAK,CAACyB,OAAO,EAAE;QAC3D,IAAI,CAACtE,OAAO,CAACsF,UAAU,CAACrB,QAAQ,EAAGsB,MAAM,IAAK;UAC5CA,MAAM,CAAC3C,KAAK,GAAGC,sBAAK,CAACC,QAAQ;UAC7ByC,MAAM,CAAC9C,MAAM,GAAGC,uBAAM,CAAC8C,OAAO;UAC9BD,MAAM,CAACrC,aAAa,GAAA9G,aAAA,CAAAA,aAAA,KACfmJ,MAAM,CAACrC,aAAa,GACpBgC,OAAO,CACX;QACH,CAAC,CAAC;MACJ;MAEA,IAAI,CAAClF,OAAO,CAACyF,SAAS,CAACxB,QAAQ,CAAC;IAClC;IAEApG,iBAAA,CAAAG,YAAA,MAAI,EAACiE,UAAS,CAAC,CAAAxG,IAAA,CAAf,IAAI;EACN;EAAC,SAAAuG,YAAA,EAEa;IACZ,IAAMG,SAAS,GAAG,IAAI,CAACnC,OAAO,CAAC0F,UAAU,CAAC,CAAC;IAE3C,IAAI,CAACvE,UAAU,CAAC5C,MAAM,CAACrC,IAAI,CAACiG,SAAS,CAAC;EACxC;EAAC,SAAAF,WAAA,EAEY;IACX,IAAME,SAAS,GAAG,IAAI,CAAChB,UAAU,CAAC5C,MAAM,CAACgE,GAAG,CAAC,CAAC;IAC9C,IAAI,CAACJ,SAAS,EAAE;MACd;IACF;IAEA,IAAI,CAACnC,OAAO,CAAC2F,UAAU,CAACxD,SAAS,CAAC;EACpC;EAAC,SAAA9C,gBAEeD,IAAsB,EAAE;IAAA,IAAAwG,cAAA;IACtC,IAAM3B,QAAQ,GAAGpG,iBAAA,CAAAG,YAAA,MAAI,EAAC6H,kBAAiB,CAAC,CAAApK,IAAA,CAAvB,IAAI,CAAqB;IAE1C,IAAI,CAACwI,QAAQ,EAAE;MACb;IACF;IACA;IACA,IAAM;MAAE6B,gBAAgB,GAAG;IAAG,CAAC,GAAG,IAAI,CAACnF,MAAM,CAACoF,MAAM,CAACC,QAAQ,CAAC,CAAC;IAC/D,IAAMC,gBAAgB,GAAGpI,iBAAA,CAAAG,YAAA,MAAI,EAACmH,iBAAgB,CAAC,CAAA1J,IAAA,CAAtB,IAAI,EAAmBqK,gBAAgB,CAAuB;IAEvF,IAAI,CAAC9F,OAAO,CAACsF,UAAU,CAACrB,QAAQ,EAAGsB,MAAM,IAAK;MAC5CA,MAAM,CAAC3C,KAAK,GAAGC,sBAAK,CAACC,QAAQ;MAC7ByC,MAAM,CAAC9C,MAAM,GAAGwD,gBAAgB,CAACxD,MAAM;MACvC8C,MAAM,CAACrC,aAAa,GAAA9G,aAAA,CAAAA,aAAA,KACfmJ,MAAM,CAACrC,aAAa,GACpB+C,gBAAgB,CAACf,OAAO,CAC5B;IACH,CAAC,CAAC;IAEF,IAAI,CAAClF,OAAO,CAACkG,QAAQ,CAACjC,QAAQ,EAAE;MAAEkC,QAAQ,GAAAP,cAAA,GAAExG,IAAI,CAAC+G,QAAQ,cAAAP,cAAA,cAAAA,cAAA,GAAI;IAAE,CAAC,CAAC;EACnE;EAAC,SAAAtG,gBAEeF,IAAsB,EAAE;IAAA,IAAAgH,eAAA;IACtC,IAAMnC,QAAQ,GAAGpG,iBAAA,CAAAG,YAAA,MAAI,EAAC6H,kBAAiB,CAAC,CAAApK,IAAA,CAAvB,IAAI,CAAqB;IAE1C,IAAI,CAACwI,QAAQ,EAAE;MACb;IACF;IAEA,IAAM;MAAExB,MAAM;MAAEyC;IAAQ,CAAC,GAAGrH,iBAAA,CAAAG,YAAA,MAAI,EAACmH,iBAAgB,CAAC,CAAA1J,IAAA,CAAtB,IAAI,EAAmB2D,IAAI,CAACgG,MAAM,CAAC;IAE/D,IAAI,CAACpF,OAAO,CAACsF,UAAU,CAACrB,QAAQ,EAAGsB,MAAM,IAAK;MAC5CA,MAAM,CAAC3C,KAAK,GAAGC,sBAAK,CAACC,QAAQ;MAC7ByC,MAAM,CAAC9C,MAAM,GAAGA,MAAM;MACtB8C,MAAM,CAACrC,aAAa,GAAA9G,aAAA,CAAAA,aAAA,KACfmJ,MAAM,CAACrC,aAAa,GACpBgC,OAAO,CACX;IACH,CAAC,CAAC;IACF,IAAI,CAAClF,OAAO,CAACkG,QAAQ,CAACjC,QAAQ,EAAE;MAAEkC,QAAQ,GAAAC,eAAA,GAAEhH,IAAI,CAAC+G,QAAQ,cAAAC,eAAA,cAAAA,eAAA,GAAI;IAAE,CAAC,CAAC;EACnE;EAAC,SAAA5G,gBAEeJ,IAAsB,EAAE;IACtC,IAAM0E,eAAe,GAAGjG,iBAAA,CAAAG,YAAA,MAAI,EAACqD,gBAAe,CAAC,CAAA5F,IAAA,CAArB,IAAI,EAAkB2D,IAAI,CAAC;IAEnD,IAAI,IAAI,CAAC+B,UAAU,CAAC3C,+BAA+B,CAAC6H,QAAQ,CAACvC,eAAe,CAAC,EAAE;MAC7E;IACF;;IAEA;IACA,IAAMG,QAAQ,GAAGpG,iBAAA,CAAAG,YAAA,MAAI,EAACmB,gBAAe,CAAC,CAAA1D,IAAA,CAArB,IAAI,EAAkB2D,IAAI,CAAC;IAE5C,IAAI,CAAC6E,QAAQ,EAAE;MACb;IACF;IAEA,IAAI,CAACjE,OAAO,CAACsF,UAAU,CAACrB,QAAQ,EAAGsB,MAAM,IAAK;MAC5CA,MAAM,CAAC3C,KAAK,GAAGC,sBAAK,CAACC,QAAQ;MAC7ByC,MAAM,CAAC9C,MAAM,GAAGC,uBAAM,CAAC8C,OAAO;IAChC,CAAC,CAAC;IACF;IACA3H,iBAAA,CAAAG,YAAA,MAAI,EAACuB,oBAAmB,CAAC,CAAA9D,IAAA,CAAzB,IAAI,EAAsB2D,IAAI;EAChC;EAAC,SAAAK,gBAEeL,IAAsB,EAAE;IACtC;IACA,IAAM6E,QAAQ,GAAGpG,iBAAA,CAAAG,YAAA,MAAI,EAACmB,gBAAe,CAAC,CAAA1D,IAAA,CAArB,IAAI,EAAkB2D,IAAI,CAAC;IAC5C,IAAI,CAAC6E,QAAQ,EAAE;MACb;IACF;IAEA,IAAI,CAACjE,OAAO,CAACsF,UAAU,CAACrB,QAAQ,EAAGsB,MAAM,IAAK;MAC5CA,MAAM,CAAC3C,KAAK,GAAGC,sBAAK,CAACC,QAAQ;MAC7ByC,MAAM,CAAC9C,MAAM,GAAGC,uBAAM,CAAC8C,OAAO;MAC9BD,MAAM,CAACrC,aAAa,GAAG;QACrBlC,OAAO,EAAE;MACX,CAAC;IACH,CAAC,CAAC;IACF;IACAnD,iBAAA,CAAAG,YAAA,MAAI,EAACuB,oBAAmB,CAAC,CAAA9D,IAAA,CAAzB,IAAI,EAAsB2D,IAAI;EAChC;EAAC,SAAAM,iBAAA,EAEkB;IACjB,IAAI,CAACM,OAAO,CAACsG,oBAAoB,CAAC,CAAC;IACnC,IAAI,CAACtG,OAAO,CAACuG,0BAA0B,CAAC,CAAC;EAC3C;EAAC,SAAAV,mBAAA,EAEoB;IACnB,IAAI,IAAI,CAAC1E,UAAU,CAAC9C,WAAW,CAAC/B,MAAM,KAAK,CAAC,EAAE;MAC5C,OAAOiF,SAAS;IAClB;IACA,OAAO,IAAI,CAACJ,UAAU,CAAC9C,WAAW,CAAC,IAAI,CAAC8C,UAAU,CAAC9C,WAAW,CAAC/B,MAAM,GAAG,CAAC,CAAC;EAC5E;EAAC,SAAA6I,kBAEiBC,MAA0B,EAAuD;IACjG,IAAIA,MAAM,CAAC9I,MAAM,KAAK,CAAC,EAAE;MACvB,OAAO;QACLmG,MAAM,EAAEC,uBAAM,CAACC,MAAM;QACrBuC,OAAO,EAAE,CAAC;MACZ,CAAC;IACH;;IAEA;IACA,IAAM,CAACnG,KAAK,CAAC,GAAGqG,MAAM;IACtB,IAAMoB,iBAAiB,GAAGC,KAAK,CAACC,OAAO,CAAC3H,KAAK,CAAC;IAC9C,IAAM4H,SAA2B,GAAGH,iBAAiB,GAAGzH,KAAK,CAAC,CAAC,CAAC,GAAGA,KAAK;IACxE,IAAM6H,UAAU,GAAG/I,iBAAA,CAAAG,YAAA,MAAI,EAAC6I,eAAc,CAAC,CAAApL,IAAA,CAApB,IAAI,EAAiBkL,SAAS,CAAC;;IAElD;IACA;IACA,IAAIH,iBAAiB,IAAIzH,KAAK,CAACzC,MAAM,GAAG,CAAC,EAAE;MACzC,IAAMwK,WAAW,GAAGjJ,iBAAA,CAAAG,YAAA,MAAI,EAAC6I,eAAc,CAAC,CAAApL,IAAA,CAApB,IAAI,EAAiBsD,KAAK,CAAC,CAAC,CAAC,CAAC;MAElD,IAAI,CAAC6H,UAAU,CAAC5F,OAAO,EAAE;QACvB4F,UAAU,CAAC5F,OAAO,GAAG8F,WAAW,CAAC9F,OAAO;MAC1C;MAEA,IAAI,CAAC4F,UAAU,CAACxD,KAAK,EAAE;QACrBwD,UAAU,CAACxD,KAAK,GAAG0D,WAAW,CAAC1D,KAAK;MACtC;IACF;IAEA,IAAM8B,OAAO,GAAG,IAAA6B,gCAA2B,EAACH,UAAU,CAAC;IACvD,IAAMnE,MAAM,GAAG,IAAAQ,uBAAkB,EAAC2D,UAAU,CAAC;IAE7C,OAAO;MAAEnE,MAAM;MAAEyC;IAAQ,CAAC;EAC5B;EAAC,SAAA2B,gBAEeF,SAA2B,EAKrC;IACJ,IAAI,CAACA,SAAS,EAAE;MACd,OAAO,CAAC,CAAC;IACX;;IAEA;IACA,IAAI,OAAOA,SAAS,KAAK,QAAQ,IAAI,EAAE,OAAO,IAAIA,SAAS,CAAC,EAAE;MAC5D,OAAO;QACL3F,OAAO,EAAE,IAAAgG,cAAS,EAACL,SAAS;MAC9B,CAAC;IACH;IAEA,OAAOA,SAAS;EAClB;AAEJ,CAAC;AAACM,OAAA,CAAAnJ,qBAAA,GAAAA,qBAAA","ignoreList":[]}